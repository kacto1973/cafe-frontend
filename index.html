<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>cafe-frontend</title>
    <link href="/src/style.css" rel="stylesheet" />
  </head>
  <body>
    <style>
      #favorites-list::-webkit-scrollbar {
        display: none;
      }
      #favorites-list {
        -ms-overflow-style: none; /* IE y Edge */
        scrollbar-width: none; /* Firefox */
      }
    </style>
    <!--
    
    INSTRUCCIONES:

    -usuario debe guardar productos para pedir las mañanas como favoritos
    -(X)Tiene que haber un login o alguna forma simulando que entró un usuario
    y que detecta los favoritos para pedirlo constantemente
    -(X)Que aparezca los productos marcados como favoritos.
    -Meterle popularidad.
    -(X)Poder ordenar como favoritos. 
    -(X)Consumir api starbucks. 
      
    ***Mandar msd tardar mañana 9:30 am repo y lo que hayamos avanzado

    -->
    <header
      class="bg-black text-white flex flex-row p-5 items-center justify-between"
    >
      <h1 class="font-bold text-2xl cursor-pointer p-2">
        Tienda de Café "Las 3 Torres"
      </h1>
      <nav>
        <ul class="flex flex-row gap-5">
          <li
            class="font-bold text-md p-3 rounded-md hover:bg-white hover:text-black hover:cursor-pointer transition-colors duration-300"
            id="login-button"
          >
            Iniciar Sesión
          </li>
          <li
            class="font-bold text-md p-3 rounded-md hover:bg-white hover:text-black hover:cursor-pointer transition-colors duration-300"
          >
            Registrarme
          </li>
        </ul>
      </nav>
    </header>

    <section class="p-10 flex flex-col gap-5">
      <h2 class="font-bold text-2xl">Tus Productos Favoritos</h2>
      <div
        class="flex flex-row gap-10 overflow-x-auto overflow-y-hidden"
        id="favorites-list"
      ></div>
    </section>
    <section class="p-10 flex flex-col gap-5">
      <h2 class="font-bold text-2xl">Nuestros Productos</h2>
      <div class="grid grid-cols-3 gap-5" id="products-list"></div>
    </section>
    <footer class="bg-black text-white p-10 flex flex-col">
      <p class="font-bold text-lg">Tienda de Café "Las 3 Torres"</p>
      <p class="font-light text-md">
        Blvd. Independencia #1234, Torreón, Coahuila
      </p>
      <p class="font-light text-md">☎️+52 662 423 7920</p>
    </footer>
    <script type="module">
      import { cafes } from "./cafes.js";

      // JS functions

      const handleRemoveFavorite = (coffee) => {
        let favoritesArray =
          JSON.parse(localStorage.getItem("favorites")) || [];

        favoritesArray = favoritesArray.filter(
          (element) => element.id !== coffee.id,
        );

        localStorage.setItem("favorites", JSON.stringify(favoritesArray));

        // Remover del DOM
        const favoritesContainer = document.getElementById("favorites-list");
        favoritesContainer.innerHTML = "";

        const favoritesFragment = document.createDocumentFragment();

        favoritesArray.forEach((coffee) => {
          const newCard = createFavoriteCard(coffee);
          favoritesFragment.appendChild(newCard);
        });

        favoritesContainer.appendChild(favoritesFragment);
      };

      const addToFavorites = (coffee) => {
        const favoritesArray =
          JSON.parse(localStorage.getItem("favorites")) || [];

        const elementExists = favoritesArray.some(
          (element) => element.id === coffee.id,
        );

        if (!elementExists) {
          favoritesArray.push(coffee);
          localStorage.setItem("favorites", JSON.stringify(favoritesArray));
        }

        // Agregar al DOM
        const favoritesContainer = document.getElementById("favorites-list");
        favoritesContainer.innerHTML = "";

        const favoritesFragment = document.createDocumentFragment();

        favoritesArray.forEach((coffee) => {
          const newCard = createFavoriteCard(coffee);
          favoritesFragment.appendChild(newCard);
        });
        favoritesContainer.appendChild(favoritesFragment);
      };

      const cerrarModal = () => {
        document.body.removeChild(
          document.getElementById("login-modal-overlay"),
        );
        document.body.removeChild(document.getElementById("login-modal"));
      };

      const handleLogin = () => {
        // Lógica de autenticación simulada
        const username = document.getElementById("username").value;
        const password = document.getElementById("password").value;
        if (username === "1111" && password === "1111") {
          localStorage.setItem("loggedIn", "true");
          alert("Inicio de sesión exitoso");
          cerrarModal();
        } else {
          alert("Credenciales incorrectas");
        }
      };

      const showLoginModal = () => {
        const overlay = document.createElement("div");
        overlay.className =
          "fixed inset-0 bg-black opacity-50 flex items-center justify-center";
        overlay.id = "login-modal-overlay";

        const modal = document.createElement("div");
        modal.className =
          "w-[300px] bg-white p-5 rounded-md absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 flex flex-col gap-5 justify-center items-center";
        modal.id = "login-modal";

        let contenidoHTML = `
          <h3 class="text-black font-bold text-lg">Iniciar Sesión</h3>
          <span class="absolute top-5 right-5 cursor-pointer font-bold text-lg" id="close-modal">&times;</span>
          <input id="username" class="w-full p-2 border-1 border-gray-400 rounded-md" type="text" placeholder="Usuario" />
          <input id="password" class="w-full p-2 border-1 border-gray-400 rounded-md" type="password" placeholder="Contraseña" />
          <button id="login-submit" class="w-full bg-black text-white p-2 rounded-md hover:bg-gray-800 transition-colors duration-300">Ingresar</button>
        `;

        modal.innerHTML = contenidoHTML;

        document.body.appendChild(overlay);
        document.body.appendChild(modal);

        document
          .getElementById("login-submit")
          .addEventListener("click", () => {
            handleLogin();
          });

        document.getElementById("close-modal").addEventListener("click", () => {
          cerrarModal();
        });
      };

      const createFavoriteCard = (coffee) => {
        const card = document.createElement("article");
        card.className =
          "flex flex-col gap-2 rounded-md min-w-[400px] max-w-[400px] overflow-hidden border-1 border-gray-400";
        card.innerHTML = `
          <img class="w-full h-[200px] object-cover" src="${coffee.imagen}" alt="${coffee.titulo}" />

          <div class="flex flex-col p-3 gap-3">
            <h3 class="font-bold text-xl">${coffee.titulo} - <span class="text-green-500">$${coffee.precio}</span></h3>
            <p class="text-md">${coffee.descripcion}</p>
            <div class="flex flex-row">
              <button id="remove-favorite-button" class="bg-red-400 text-white p-2 rounded-md hover:bg-red-500 transition-colors duration-300 mr-2">Remover</button>
              <button class="ml-2 bg-green-600 text-white p-2 rounded-md hover:bg-green-700 transition-colors duration-300">Ordenar</button>
            </div>
          </div>
       `;

        const removeButton = card.querySelector("#remove-favorite-button");
        removeButton.addEventListener("click", () => {
          handleRemoveFavorite(coffee);
        });

        return card;
      };

      const createProductCard = (coffee) => {
        const card = document.createElement("article");
        card.className =
          "flex flex-col rounded-md min-w-[400px] overflow-hidden border-1 border-gray-400";
        card.innerHTML = `
          <img class="w-full h-[200px] object-cover" src="${coffee.imagen}" alt="${coffee.titulo}" />

          <div class="flex flex-col p-5 gap-3">
            <h3 class="font-bold text-xl">${coffee.titulo} - <span class="text-green-500">$${coffee.precio}</span></h3>
            <p class="text-md">${coffee.descripcion}</p>
            <div class="flex flex-row">
              <button id="favorite-button" class="bg-yellow-400 text-white p-2 rounded-md hover:bg-yellow-500 transition-colors duration-300 mr-2">Favorito</button>
              <button class="ml-2 bg-green-600 text-white p-2 rounded-md hover:bg-green-700 transition-colors duration-300">Ordenar</button>
            </div>
          </div>
       `;

        const favoriteButton = card.querySelector("#favorite-button");
        favoriteButton.addEventListener("click", () => {
          addToFavorites(coffee);
          alert(`${coffee.titulo} ha sido agregado a tus favoritos.`);
        });

        return card;
      };

      // JS functions

      //////////////// Productos favoritos

      const favoritesContainer = document.getElementById("favorites-list");
      const favoritesFragment = document.createDocumentFragment();

      const favoritesList = JSON.parse(localStorage.getItem("favorites")) || [];

      if (favoritesList.length > 0) {
        favoritesList.forEach((coffee) => {
          const newCard = createFavoriteCard(coffee);
          favoritesFragment.appendChild(newCard);
        });

        favoritesContainer.appendChild(favoritesFragment);
      } else {
        favoritesContainer.innerHTML = `<p class="font-light text-md">No tienes productos favoritos aún. Agrega algunos desde la sección de productos.</p>`;
      }

      //////////////// Nuestros productos

      const productsContainer = document.getElementById("products-list");
      const productsFragment = document.createDocumentFragment();

      cafes.forEach((coffee) => {
        const newCard = createProductCard(coffee);
        productsFragment.appendChild(newCard);
      });

      productsContainer.appendChild(productsFragment);

      //////////////// Event Listeners

      document.getElementById("login-button").addEventListener("click", () => {
        showLoginModal();
      });
    </script>
  </body>
</html>
